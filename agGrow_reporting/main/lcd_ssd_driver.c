/*
 * lcd_ssd_driver.c
 *
 *  Created on: Mar 29, 2021
 *      Author: popad
 */

//============================================================================
// lcd.c: Adapted from the lcdwiki.com examples.
//============================================================================
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "esp_system.h"
#include "driver/spi_master.h"
#include "driver/gpio.h"
#include <stdint.h>
#include "lcd_ssd_driver.h"
#include "driver/ledc.h"
//#include "includes/main_page.c"

#define PIN_NUM_MISO 27
#define PIN_NUM_SDI 16//23
#define PIN_NUM_SCL  19
#define PIN_NUM_SCS   17//22
#define PIN_NUM_SDC   21
#define PIN_NUM_RST  18
#define PIN_NUM_BCKL 5
void LCD_SetWindow(spi_device_handle_t spi, uint16_t xStart, uint16_t yStart, uint16_t xEnd, uint16_t yEnd);
/*
 The LCD needs a bunch of command/argument values to be initialized. They are stored in this struct.
*/
typedef struct {
    uint8_t cmd;
    uint8_t data[16];
    uint8_t databytes; //No of data in data; bit 7 = delay after set; 0xFF = end of cmds.
} lcd_init_cmd_t;

typedef enum {
    LCD_TYPE_ILI = 1,
    LCD_TYPE_ST,
    LCD_TYPE_MAX,
} type_lcd_t;
lcd_dev_t lcddev;
extern const Picture *image;
spi_bus spi_bus_caller;
// A 12x6 font
const unsigned char asc2_1206[95][12]={
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*" ",0*/
{0x00,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x00,0x04,0x00,0x00},/*"!",1*/
{0x00,0x14,0x0A,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*""",2*/
{0x00,0x00,0x14,0x14,0x3F,0x14,0x0A,0x3F,0x0A,0x0A,0x00,0x00},/*"#",3*/
{0x00,0x04,0x1E,0x15,0x05,0x06,0x0C,0x14,0x15,0x0F,0x04,0x00},/*"$",4*/
{0x00,0x00,0x12,0x15,0x0D,0x0A,0x14,0x2C,0x2A,0x12,0x00,0x00},/*"%",5*/
{0x00,0x00,0x04,0x0A,0x0A,0x1E,0x15,0x15,0x09,0x36,0x00,0x00},/*"&",6*/
{0x00,0x02,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"'",7*/
{0x00,0x20,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x20,0x00},/*"(",8*/
{0x00,0x02,0x04,0x08,0x08,0x08,0x08,0x08,0x08,0x04,0x02,0x00},/*")",9*/
{0x00,0x00,0x00,0x04,0x15,0x0E,0x0E,0x15,0x04,0x00,0x00,0x00},/*"*",10*/
{0x00,0x00,0x04,0x04,0x04,0x1F,0x04,0x04,0x04,0x00,0x00,0x00},/*"+",11*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x02,0x01},/*",",12*/
{0x00,0x00,0x00,0x00,0x00,0x1F,0x00,0x00,0x00,0x00,0x00,0x00},/*"-",13*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00},/*".",14*/
{0x00,0x10,0x08,0x08,0x08,0x04,0x04,0x02,0x02,0x02,0x01,0x00},/*"/",15*/
{0x00,0x00,0x0E,0x11,0x11,0x11,0x11,0x11,0x11,0x0E,0x00,0x00},/*"0",16*/
{0x00,0x00,0x04,0x06,0x04,0x04,0x04,0x04,0x04,0x0E,0x00,0x00},/*"1",17*/
{0x00,0x00,0x0E,0x11,0x11,0x08,0x04,0x02,0x01,0x1F,0x00,0x00},/*"2",18*/
{0x00,0x00,0x0E,0x11,0x10,0x0C,0x10,0x10,0x11,0x0E,0x00,0x00},/*"3",19*/
{0x00,0x00,0x08,0x0C,0x0A,0x0A,0x09,0x1E,0x08,0x18,0x00,0x00},/*"4",20*/
{0x00,0x00,0x1F,0x01,0x01,0x0F,0x10,0x10,0x11,0x0E,0x00,0x00},/*"5",21*/
{0x00,0x00,0x0E,0x09,0x01,0x0F,0x11,0x11,0x11,0x0E,0x00,0x00},/*"6",22*/
{0x00,0x00,0x1F,0x09,0x08,0x04,0x04,0x04,0x04,0x04,0x00,0x00},/*"7",23*/
{0x00,0x00,0x0E,0x11,0x11,0x0E,0x11,0x11,0x11,0x0E,0x00,0x00},/*"8",24*/
{0x00,0x00,0x0E,0x11,0x11,0x11,0x1E,0x10,0x12,0x0E,0x00,0x00},/*"9",25*/
{0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x04,0x00,0x00},/*":",26*/
{0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,0x04,0x00},/*";",27*/
{0x00,0x20,0x10,0x08,0x04,0x02,0x04,0x08,0x10,0x20,0x00,0x00},/*"<",28*/
{0x00,0x00,0x00,0x00,0x1F,0x00,0x00,0x1F,0x00,0x00,0x00,0x00},/*"=",29*/
{0x00,0x02,0x04,0x08,0x10,0x20,0x10,0x08,0x04,0x02,0x00,0x00},/*">",30*/
{0x00,0x00,0x0E,0x11,0x11,0x08,0x04,0x04,0x00,0x04,0x00,0x00},/*"?",31*/
{0x00,0x00,0x0E,0x11,0x19,0x15,0x15,0x1D,0x01,0x1E,0x00,0x00},/*"@",32*/
{0x00,0x00,0x04,0x04,0x0C,0x0A,0x0A,0x1E,0x12,0x33,0x00,0x00},/*"A",33*/
{0x00,0x00,0x0F,0x12,0x12,0x0E,0x12,0x12,0x12,0x0F,0x00,0x00},/*"B",34*/
{0x00,0x00,0x1E,0x11,0x01,0x01,0x01,0x01,0x11,0x0E,0x00,0x00},/*"C",35*/
{0x00,0x00,0x0F,0x12,0x12,0x12,0x12,0x12,0x12,0x0F,0x00,0x00},/*"D",36*/
{0x00,0x00,0x1F,0x12,0x0A,0x0E,0x0A,0x02,0x12,0x1F,0x00,0x00},/*"E",37*/
{0x00,0x00,0x1F,0x12,0x0A,0x0E,0x0A,0x02,0x02,0x07,0x00,0x00},/*"F",38*/
{0x00,0x00,0x1C,0x12,0x01,0x01,0x39,0x11,0x12,0x0C,0x00,0x00},/*"G",39*/
{0x00,0x00,0x33,0x12,0x12,0x1E,0x12,0x12,0x12,0x33,0x00,0x00},/*"H",40*/
{0x00,0x00,0x1F,0x04,0x04,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"I",41*/
{0x00,0x00,0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x09,0x07,0x00},/*"J",42*/
{0x00,0x00,0x37,0x12,0x0A,0x06,0x0A,0x0A,0x12,0x37,0x00,0x00},/*"K",43*/
{0x00,0x00,0x07,0x02,0x02,0x02,0x02,0x02,0x22,0x3F,0x00,0x00},/*"L",44*/
{0x00,0x00,0x1B,0x1B,0x1B,0x1B,0x15,0x15,0x15,0x15,0x00,0x00},/*"M",45*/
{0x00,0x00,0x3B,0x12,0x16,0x16,0x1A,0x1A,0x12,0x17,0x00,0x00},/*"N",46*/
{0x00,0x00,0x0E,0x11,0x11,0x11,0x11,0x11,0x11,0x0E,0x00,0x00},/*"O",47*/
{0x00,0x00,0x0F,0x12,0x12,0x0E,0x02,0x02,0x02,0x07,0x00,0x00},/*"P",48*/
{0x00,0x00,0x0E,0x11,0x11,0x11,0x11,0x17,0x19,0x0E,0x18,0x00},/*"Q",49*/
{0x00,0x00,0x0F,0x12,0x12,0x0E,0x0A,0x12,0x12,0x37,0x00,0x00},/*"R",50*/
{0x00,0x00,0x1E,0x11,0x01,0x06,0x08,0x10,0x11,0x0F,0x00,0x00},/*"S",51*/
{0x00,0x00,0x1F,0x15,0x04,0x04,0x04,0x04,0x04,0x0E,0x00,0x00},/*"T",52*/
{0x00,0x00,0x33,0x12,0x12,0x12,0x12,0x12,0x12,0x0C,0x00,0x00},/*"U",53*/
{0x00,0x00,0x33,0x12,0x12,0x0A,0x0A,0x0C,0x04,0x04,0x00,0x00},/*"V",54*/
{0x00,0x00,0x15,0x15,0x15,0x0E,0x0A,0x0A,0x0A,0x0A,0x00,0x00},/*"W",55*/
{0x00,0x00,0x1B,0x0A,0x0A,0x04,0x04,0x0A,0x0A,0x1B,0x00,0x00},/*"X",56*/
{0x00,0x00,0x1B,0x0A,0x0A,0x04,0x04,0x04,0x04,0x0E,0x00,0x00},/*"Y",57*/
{0x00,0x00,0x1F,0x09,0x08,0x04,0x04,0x02,0x12,0x1F,0x00,0x00},/*"Z",58*/
{0x00,0x1C,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x1C,0x00},/*"[",59*/
{0x00,0x02,0x02,0x02,0x04,0x04,0x08,0x08,0x08,0x10,0x00,0x00},/*"\",60*/
{0x00,0x0E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x0E,0x00},/*"]",61*/
{0x00,0x04,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"^",62*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F},/*"_",63*/
{0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"`",64*/
{0x00,0x00,0x00,0x00,0x00,0x0C,0x12,0x1C,0x12,0x3C,0x00,0x00},/*"a",65*/
{0x00,0x00,0x03,0x02,0x02,0x0E,0x12,0x12,0x12,0x0E,0x00,0x00},/*"b",66*/
{0x00,0x00,0x00,0x00,0x00,0x1C,0x12,0x02,0x02,0x1C,0x00,0x00},/*"c",67*/
{0x00,0x00,0x18,0x10,0x10,0x1C,0x12,0x12,0x12,0x3C,0x00,0x00},/*"d",68*/
{0x00,0x00,0x00,0x00,0x00,0x0C,0x12,0x1E,0x02,0x1C,0x00,0x00},/*"e",69*/
{0x00,0x00,0x38,0x04,0x04,0x1E,0x04,0x04,0x04,0x1E,0x00,0x00},/*"f",70*/
{0x00,0x00,0x00,0x00,0x00,0x3C,0x12,0x0C,0x02,0x1E,0x22,0x1C},/*"g",71*/
{0x00,0x00,0x03,0x02,0x02,0x0E,0x12,0x12,0x12,0x37,0x00,0x00},/*"h",72*/
{0x00,0x00,0x04,0x00,0x00,0x06,0x04,0x04,0x04,0x0E,0x00,0x00},/*"i",73*/
{0x00,0x00,0x08,0x00,0x00,0x0C,0x08,0x08,0x08,0x08,0x08,0x07},/*"j",74*/
{0x00,0x00,0x03,0x02,0x02,0x3A,0x0A,0x0E,0x12,0x37,0x00,0x00},/*"k",75*/
{0x00,0x00,0x07,0x04,0x04,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"l",76*/
{0x00,0x00,0x00,0x00,0x00,0x0F,0x15,0x15,0x15,0x15,0x00,0x00},/*"m",77*/
{0x00,0x00,0x00,0x00,0x00,0x0F,0x12,0x12,0x12,0x37,0x00,0x00},/*"n",78*/
{0x00,0x00,0x00,0x00,0x00,0x0C,0x12,0x12,0x12,0x0C,0x00,0x00},/*"o",79*/
{0x00,0x00,0x00,0x00,0x00,0x0F,0x12,0x12,0x12,0x0E,0x02,0x07},/*"p",80*/
{0x00,0x00,0x00,0x00,0x00,0x1C,0x12,0x12,0x12,0x1C,0x10,0x38},/*"q",81*/
{0x00,0x00,0x00,0x00,0x00,0x1B,0x06,0x02,0x02,0x07,0x00,0x00},/*"r",82*/
{0x00,0x00,0x00,0x00,0x00,0x1E,0x02,0x0C,0x10,0x1E,0x00,0x00},/*"s",83*/
{0x00,0x00,0x00,0x04,0x04,0x0E,0x04,0x04,0x04,0x18,0x00,0x00},/*"t",84*/
{0x00,0x00,0x00,0x00,0x00,0x1B,0x12,0x12,0x12,0x3C,0x00,0x00},/*"u",85*/
{0x00,0x00,0x00,0x00,0x00,0x37,0x12,0x0A,0x0C,0x04,0x00,0x00},/*"v",86*/
{0x00,0x00,0x00,0x00,0x00,0x15,0x15,0x0E,0x0A,0x0A,0x00,0x00},/*"w",87*/
{0x00,0x00,0x00,0x00,0x00,0x1B,0x0A,0x04,0x0A,0x1B,0x00,0x00},/*"x",88*/
{0x00,0x00,0x00,0x00,0x00,0x37,0x12,0x0A,0x0C,0x04,0x04,0x03},/*"y",89*/
{0x00,0x00,0x00,0x00,0x00,0x1E,0x08,0x04,0x04,0x1E,0x00,0x00},/*"z",90*/
{0x00,0x18,0x08,0x08,0x08,0x04,0x08,0x08,0x08,0x08,0x18,0x00},/*"{",91*/
{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},/*"|",92*/
{0x00,0x06,0x04,0x04,0x04,0x08,0x04,0x04,0x04,0x04,0x06,0x00},/*"}",93*/
{0x02,0x25,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} /*"~",94*/
};

// A 16x8 font
const unsigned char asc2_1608[95][16]={
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*" ",0*/
{0x00,0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x18,0x18,0x00,0x00},/*"!",1*/
{0x00,0x48,0x6C,0x24,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*""",2*/
{0x00,0x00,0x00,0x24,0x24,0x24,0x7F,0x12,0x12,0x12,0x7F,0x12,0x12,0x12,0x00,0x00},/*"#",3*/
{0x00,0x00,0x08,0x1C,0x2A,0x2A,0x0A,0x0C,0x18,0x28,0x28,0x2A,0x2A,0x1C,0x08,0x08},/*"$",4*/
{0x00,0x00,0x00,0x22,0x25,0x15,0x15,0x15,0x2A,0x58,0x54,0x54,0x54,0x22,0x00,0x00},/*"%",5*/
{0x00,0x00,0x00,0x0C,0x12,0x12,0x12,0x0A,0x76,0x25,0x29,0x11,0x91,0x6E,0x00,0x00},/*"&",6*/
{0x00,0x06,0x06,0x04,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"'",7*/
{0x00,0x40,0x20,0x10,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x10,0x20,0x40,0x00},/*"(",8*/
{0x00,0x02,0x04,0x08,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x08,0x08,0x04,0x02,0x00},/*")",9*/
{0x00,0x00,0x00,0x00,0x08,0x08,0x6B,0x1C,0x1C,0x6B,0x08,0x08,0x00,0x00,0x00,0x00},/*"*",10*/
{0x00,0x00,0x00,0x00,0x08,0x08,0x08,0x08,0x7F,0x08,0x08,0x08,0x08,0x00,0x00,0x00},/*"+",11*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x04,0x03},/*",",12*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"-",13*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00},/*".",14*/
{0x00,0x00,0x80,0x40,0x40,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x02,0x00},/*"/",15*/
{0x00,0x00,0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00,0x00},/*"0",16*/
{0x00,0x00,0x00,0x08,0x0E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"1",17*/
{0x00,0x00,0x00,0x3C,0x42,0x42,0x42,0x20,0x20,0x10,0x08,0x04,0x42,0x7E,0x00,0x00},/*"2",18*/
{0x00,0x00,0x00,0x3C,0x42,0x42,0x20,0x18,0x20,0x40,0x40,0x42,0x22,0x1C,0x00,0x00},/*"3",19*/
{0x00,0x00,0x00,0x20,0x30,0x28,0x24,0x24,0x22,0x22,0x7E,0x20,0x20,0x78,0x00,0x00},/*"4",20*/
{0x00,0x00,0x00,0x7E,0x02,0x02,0x02,0x1A,0x26,0x40,0x40,0x42,0x22,0x1C,0x00,0x00},/*"5",21*/
{0x00,0x00,0x00,0x38,0x24,0x02,0x02,0x1A,0x26,0x42,0x42,0x42,0x24,0x18,0x00,0x00},/*"6",22*/
{0x00,0x00,0x00,0x7E,0x22,0x22,0x10,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00},/*"7",23*/
{0x00,0x00,0x00,0x3C,0x42,0x42,0x42,0x24,0x18,0x24,0x42,0x42,0x42,0x3C,0x00,0x00},/*"8",24*/
{0x00,0x00,0x00,0x18,0x24,0x42,0x42,0x42,0x64,0x58,0x40,0x40,0x24,0x1C,0x00,0x00},/*"9",25*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00},/*":",26*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x04},/*";",27*/
{0x00,0x00,0x00,0x40,0x20,0x10,0x08,0x04,0x02,0x04,0x08,0x10,0x20,0x40,0x00,0x00},/*"<",28*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x00},/*"=",29*/
{0x00,0x00,0x00,0x02,0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x02,0x00,0x00},/*">",30*/
{0x00,0x00,0x00,0x3C,0x42,0x42,0x46,0x40,0x20,0x10,0x10,0x00,0x18,0x18,0x00,0x00},/*"?",31*/
{0x00,0x00,0x00,0x1C,0x22,0x5A,0x55,0x55,0x55,0x55,0x2D,0x42,0x22,0x1C,0x00,0x00},/*"@",32*/
{0x00,0x00,0x00,0x08,0x08,0x18,0x14,0x14,0x24,0x3C,0x22,0x42,0x42,0xE7,0x00,0x00},/*"A",33*/
{0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x1E,0x22,0x42,0x42,0x42,0x22,0x1F,0x00,0x00},/*"B",34*/
{0x00,0x00,0x00,0x7C,0x42,0x42,0x01,0x01,0x01,0x01,0x01,0x42,0x22,0x1C,0x00,0x00},/*"C",35*/
{0x00,0x00,0x00,0x1F,0x22,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x22,0x1F,0x00,0x00},/*"D",36*/
{0x00,0x00,0x00,0x3F,0x42,0x12,0x12,0x1E,0x12,0x12,0x02,0x42,0x42,0x3F,0x00,0x00},/*"E",37*/
{0x00,0x00,0x00,0x3F,0x42,0x12,0x12,0x1E,0x12,0x12,0x02,0x02,0x02,0x07,0x00,0x00},/*"F",38*/
{0x00,0x00,0x00,0x3C,0x22,0x22,0x01,0x01,0x01,0x71,0x21,0x22,0x22,0x1C,0x00,0x00},/*"G",39*/
{0x00,0x00,0x00,0xE7,0x42,0x42,0x42,0x42,0x7E,0x42,0x42,0x42,0x42,0xE7,0x00,0x00},/*"H",40*/
{0x00,0x00,0x00,0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"I",41*/
{0x00,0x00,0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x11,0x0F},/*"J",42*/
{0x00,0x00,0x00,0x77,0x22,0x12,0x0A,0x0E,0x0A,0x12,0x12,0x22,0x22,0x77,0x00,0x00},/*"K",43*/
{0x00,0x00,0x00,0x07,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x42,0x7F,0x00,0x00},/*"L",44*/
{0x00,0x00,0x00,0x77,0x36,0x36,0x36,0x36,0x2A,0x2A,0x2A,0x2A,0x2A,0x6B,0x00,0x00},/*"M",45*/
{0x00,0x00,0x00,0xE3,0x46,0x46,0x4A,0x4A,0x52,0x52,0x52,0x62,0x62,0x47,0x00,0x00},/*"N",46*/
{0x00,0x00,0x00,0x1C,0x22,0x41,0x41,0x41,0x41,0x41,0x41,0x41,0x22,0x1C,0x00,0x00},/*"O",47*/
{0x00,0x00,0x00,0x3F,0x42,0x42,0x42,0x42,0x3E,0x02,0x02,0x02,0x02,0x07,0x00,0x00},/*"P",48*/
{0x00,0x00,0x00,0x1C,0x22,0x41,0x41,0x41,0x41,0x41,0x4D,0x53,0x32,0x1C,0x60,0x00},/*"Q",49*/
{0x00,0x00,0x00,0x3F,0x42,0x42,0x42,0x3E,0x12,0x12,0x22,0x22,0x42,0xC7,0x00,0x00},/*"R",50*/
{0x00,0x00,0x00,0x7C,0x42,0x42,0x02,0x04,0x18,0x20,0x40,0x42,0x42,0x3E,0x00,0x00},/*"S",51*/
{0x00,0x00,0x00,0x7F,0x49,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x1C,0x00,0x00},/*"T",52*/
{0x00,0x00,0x00,0xE7,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x3C,0x00,0x00},/*"U",53*/
{0x00,0x00,0x00,0xE7,0x42,0x42,0x22,0x24,0x24,0x14,0x14,0x18,0x08,0x08,0x00,0x00},/*"V",54*/
{0x00,0x00,0x00,0x6B,0x49,0x49,0x49,0x49,0x55,0x55,0x36,0x22,0x22,0x22,0x00,0x00},/*"W",55*/
{0x00,0x00,0x00,0xE7,0x42,0x24,0x24,0x18,0x18,0x18,0x24,0x24,0x42,0xE7,0x00,0x00},/*"X",56*/
{0x00,0x00,0x00,0x77,0x22,0x22,0x14,0x14,0x08,0x08,0x08,0x08,0x08,0x1C,0x00,0x00},/*"Y",57*/
{0x00,0x00,0x00,0x7E,0x21,0x20,0x10,0x10,0x08,0x04,0x04,0x42,0x42,0x3F,0x00,0x00},/*"Z",58*/
{0x00,0x78,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x78,0x00},/*"[",59*/
{0x00,0x00,0x02,0x02,0x04,0x04,0x08,0x08,0x08,0x10,0x10,0x20,0x20,0x20,0x40,0x40},/*"\",60*/
{0x00,0x1E,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1E,0x00},/*"]",61*/
{0x00,0x38,0x44,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"^",62*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF},/*"_",63*/
{0x00,0x06,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"`",64*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x78,0x44,0x42,0x42,0xFC,0x00,0x00},/*"a",65*/
{0x00,0x00,0x00,0x03,0x02,0x02,0x02,0x1A,0x26,0x42,0x42,0x42,0x26,0x1A,0x00,0x00},/*"b",66*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x02,0x02,0x02,0x44,0x38,0x00,0x00},/*"c",67*/
{0x00,0x00,0x00,0x60,0x40,0x40,0x40,0x78,0x44,0x42,0x42,0x42,0x64,0xD8,0x00,0x00},/*"d",68*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x7E,0x02,0x02,0x42,0x3C,0x00,0x00},/*"e",69*/
{0x00,0x00,0x00,0xF0,0x88,0x08,0x08,0x7E,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"f",70*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x22,0x22,0x1C,0x02,0x3C,0x42,0x42,0x3C},/*"g",71*/
{0x00,0x00,0x00,0x03,0x02,0x02,0x02,0x3A,0x46,0x42,0x42,0x42,0x42,0xE7,0x00,0x00},/*"h",72*/
{0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x0E,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"i",73*/
{0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x38,0x20,0x20,0x20,0x20,0x20,0x20,0x22,0x1E},/*"j",74*/
{0x00,0x00,0x00,0x03,0x02,0x02,0x02,0x72,0x12,0x0A,0x16,0x12,0x22,0x77,0x00,0x00},/*"k",75*/
{0x00,0x00,0x00,0x0E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"l",76*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x92,0x92,0x92,0x92,0x92,0xB7,0x00,0x00},/*"m",77*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3B,0x46,0x42,0x42,0x42,0x42,0xE7,0x00,0x00},/*"n",78*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x42,0x42,0x42,0x42,0x3C,0x00,0x00},/*"o",79*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1B,0x26,0x42,0x42,0x42,0x22,0x1E,0x02,0x07},/*"p",80*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x44,0x42,0x42,0x42,0x44,0x78,0x40,0xE0},/*"q",81*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x77,0x4C,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"r",82*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x42,0x02,0x3C,0x40,0x42,0x3E,0x00,0x00},/*"s",83*/
{0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x3E,0x08,0x08,0x08,0x08,0x08,0x30,0x00,0x00},/*"t",84*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x63,0x42,0x42,0x42,0x42,0x62,0xDC,0x00,0x00},/*"u",85*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE7,0x42,0x24,0x24,0x14,0x08,0x08,0x00,0x00},/*"v",86*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xEB,0x49,0x49,0x55,0x55,0x22,0x22,0x00,0x00},/*"w",87*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x76,0x24,0x18,0x18,0x18,0x24,0x6E,0x00,0x00},/*"x",88*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE7,0x42,0x24,0x24,0x14,0x18,0x08,0x08,0x07},/*"y",89*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x22,0x10,0x08,0x08,0x44,0x7E,0x00,0x00},/*"z",90*/
{0x00,0xC0,0x20,0x20,0x20,0x20,0x20,0x10,0x20,0x20,0x20,0x20,0x20,0x20,0xC0,0x00},/*"{",91*/
{0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10},/*"|",92*/
{0x00,0x06,0x08,0x08,0x08,0x08,0x08,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x06,0x00},/*"}",93*/
{0x0C,0x32,0xC2,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"~",94*/
};
//Place data into DRAM. Constant data gets placed into DROM by default, which is not accessible by DMA.
/*
DRAM_ATTR static const lcd_init_cmd_t ssd_init_cmds[]={
    {SSD2119_SLEEP_MODE_1_REG, {0x00, 0x01}, 2},
    {SSD2119_PWR_CTRL_5_REG, {0x00, 0xB2}, 2},
    {SSD2119_VCOM_OTP_1_REG, {0x00, 0x06}, 2},
    {SSD2119_OSC_START_REG, {0x00, 0x01}, 2},
    {SSD2119_OUTPUT_CTRL_REG, {0x30, 0xEF}, 2},
    {SSD2119_LCD_DRIVE_AC_CTRL_REG, {0x06, 0x00}, 2},
    {SSD2119_SLEEP_MODE_1_REG, {0x00, 0x00}, 2},
	{0, {0}, 0xff}
};

DRAM_ATTR static const lcd_init_cmd_t ssd_init2_cmds[]={
	{SSD2119_ENTRY_MODE_REG, {0x68, 0x30}, 2},
    {SSD2119_SLEEP_MODE_2_REG, {0x09, 0x99}, 2},
    {SSD2119_ANALOG_SET_REG, {0x38, 0x00}, 2},
    {SSD2119_DISPLAY_CTRL_REG, {0x00, 0x33}, 2},
    {SSD2119_PWR_CTRL_2_REG, {0x00, 0x05}, 2},
    {SSD2119_GAMMA_CTRL_1_REG, {0x00, 0x00}, 2},
    {SSD2119_GAMMA_CTRL_2_REG, {0x03, 0x03}, 2},
    {SSD2119_GAMMA_CTRL_3_REG, {0x04, 0x07}, 2},
    {SSD2119_GAMMA_CTRL_4_REG, {0x03, 0x01}, 2},
    {SSD2119_GAMMA_CTRL_5_REG, {0x03, 0x01}, 2},
    {SSD2119_GAMMA_CTRL_6_REG, {0x04, 0x03}, 2},
    {SSD2119_GAMMA_CTRL_7_REG, {0x07, 0x07}, 2},
    {SSD2119_GAMMA_CTRL_8_REG, {0x04, 0x00}, 2},
    {SSD2119_GAMMA_CTRL_9_REG, {0x0A, 0x00}, 2},
    {SSD2119_GAMMA_CTRL_10_REG, {0x10, 0x00}, 2},
    {SSD2119_PWR_CTRL_3_REG, {0x00, 0x0A}, 2},
    {SSD2119_PWR_CTRL_4_REG, {0x2E, 0x00}, 2},
	{SSD2119_V_RAM_POS_REG, {0x00, 0xEF}, 2},
	{SSD2119_H_RAM_START_REG, {0x00, 0x00}, 2},
	{SSD2119_H_RAM_END_REG, {0x01, 0x3F}, 2},
	{SSD2119_X_RAM_ADDR_REG, {0x00, 0x00}, 2},
    {SSD2119_Y_RAM_ADDR_REG, {0x00, 0x00}, 2},
    {SSD2119_RAM_DATA_REG, {0x00, 0x00}, 2},
	{0, {0}, 0xff}
};
*/
void lcd_cmd(spi_device_handle_t spi, const uint8_t cmd)
{
	//gpio_set_level(PIN_NUM_SCS, 0);
    esp_err_t ret;
    spi_transaction_t t;
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=8;                     //Command is 8 bits
    t.tx_buffer=&cmd;               //The data is the cmd itself
    t.user=(void*)0;                //D/C needs to be set to 0
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    //gpio_set_level(PIN_NUM_SCS, 1);
    assert(ret==ESP_OK);            //Should have had no issues.
}

void lcd_data(spi_device_handle_t spi, const uint8_t *data, int len)
{
	//gpio_set_level(PIN_NUM_SCS, 0);
    esp_err_t ret;
    spi_transaction_t t;
    if (len==0) return;             //no need to send anything
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=len*8;                 //Len is in bytes, transaction length is in bits.
    t.tx_buffer=data;               //Data
    t.user=(void*)1;                //D/C needs to be set to 1
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    assert(ret==ESP_OK);            //Should have had no issues.
    //gpio_set_level(PIN_NUM_SCS, 1);
}

void lcd_data_np(spi_device_handle_t spi, uint8_t data, int len)
{
	//gpio_set_level(PIN_NUM_SCS, 0);
    esp_err_t ret;
    spi_transaction_t t;
    if (len==0) return;             //no need to send anything
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=len*8;                 //Len is in bytes, transaction length is in bits.
    t.tx_buffer=&data;               //Data
    t.user=(void*)1;                //D/C needs to be set to 1
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    assert(ret==ESP_OK);            //Should have had no issues.
    //gpio_set_level(PIN_NUM_SCS, 1);
}
//This function is called (in irq context!) just before a transmission starts. It will
//set the D/C line to the value indicated in the user field.
void lcd_spi_pre_transfer_callback(spi_transaction_t *t)
{
    int dc=(int)t->user;
    gpio_set_level(PIN_NUM_SDC, dc);
}


// Write to an LCD "register"
void LCD_WR_REG(spi_device_handle_t spi, uint8_t data)
{
	lcd_cmd(spi, data);
}

// Write 8-bit data to the LCD
void LCD_WR_DATA(spi_device_handle_t spi, uint8_t data)
{
	/*const uint8_t dataArr[1] = {data};
	const uint8_t *p;
	p = dataArr;
	lcd_data(HSPI_HOST, p, 1);
	*/
	//gpio_set_level(PIN_NUM_SCS, 0);
    esp_err_t ret;
    spi_transaction_t t;
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=8;                 //Len is in bytes, transaction length is in bits.
    t.tx_buffer=&data;               //Data
    t.user=(void*)1;                //D/C needs to be set to 1
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    //gpio_set_level(PIN_NUM_SCS, 1);
    assert(ret==ESP_OK);            //Should have had no issues.
}

// Write 16-bit data
void LCD_WriteData16(spi_device_handle_t spi, u16 data16)
{
	/*
	uint8_t dataArr[2] = {data>>8, data & 0xFF};
	const uint8_t *p;
	p = dataArr;
	lcd_data(HSPI_HOST, p, 2);
	*/
	//printf("LCD SSD2119: LCD_WR_DATA Start\n");
	//gpio_set_level(PIN_NUM_SCS, 0);
    uint8_t data = (uint8_t)(data16>>8);
	esp_err_t ret;
    spi_transaction_t t;
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=8;                 //Len is in bytes, transaction length is in bits.
    t.tx_buffer=&data;               //Data
    t.user=(void*)1;                //D/C needs to be set to 1
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    //gpio_set_level(PIN_NUM_SCS, 1);
	//printf("LCD SSD2119: LCD_WR8_DATA End\n");
//    vTaskDelay(50 / portTICK_RATE_MS);
    data = (uint8_t)(data16 & 0xFF);
    //gpio_set_level(PIN_NUM_SCS, 0);
    memset(&t, 0, sizeof(t));       //Zero out the transaction
    t.length=8;                 //Len is in bytes, transaction length is in bits.
    t.tx_buffer=&data;               //Data
    t.user=(void*)1;                //D/C needs to be set to 1
    ret=spi_device_polling_transmit(spi, &t);  //Transmit!
    //gpio_set_level(PIN_NUM_SCS, 1);
    assert(ret==ESP_OK);            //Should have had no issues.

	//printf("LCD SSD2119: LCD_WR16_DATA End\n");

}

// Select an LCD "register" and write 8-bit data to it.
void LCD_WriteReg(spi_device_handle_t spi, uint8_t LCD_Reg, uint16_t LCD_RegValue)
{
    LCD_WR_REG(spi, LCD_Reg);
    LCD_WriteData16(spi, LCD_RegValue);
}

// Issue the "write RAM" command configured for the display.
void LCD_WriteRAM_Prepare(spi_device_handle_t spi)
{
	//printf("LCD SSD2119: RAM Preparing\n");
    LCD_WR_REG(spi, lcddev.wramcmd);
	//printf("LCD SSD2119: RAM Prepared\n");
}

// Configure the lcddev fields for the display orientation.
void LCD_direction(void)
{
    lcddev.setxcmd=0x4E;
    lcddev.setycmd=0x4F;
    lcddev.wramcmd=0x22;
    lcddev.height = LCD_H;
    lcddev.width = LCD_W;
}

//===========================================================================
// Set the entire display to one color
//===========================================================================
void LCD_Clear(spi_device_handle_t spi, u16 Color)
{
    unsigned int i,m;
    LCD_SetWindow(spi, 0,0,lcddev.width-1,lcddev.height-1);

    for(i=0;i<lcddev.height;i++)
    {
        for(m=0;m<lcddev.width;m++)
        {
            LCD_WriteData16(spi, Color);
        }
    }

}

//===========================================================================
// Select a subset of the display to work on, and issue the "Write RAM"
// command to prepare to send pixel data to it.
//===========================================================================
void LCD_SetWindow(spi_device_handle_t spi, uint16_t xStart, uint16_t yStart, uint16_t xEnd, uint16_t yEnd)
{
    LCD_WR_REG(spi, SSD2119_H_RAM_START_REG);
    LCD_WR_DATA(spi, (uint8_t)(xStart>>8));
    LCD_WR_DATA(spi, (uint8_t)(0x00FF & xStart));
    LCD_WR_REG(spi, SSD2119_H_RAM_END_REG);
    LCD_WR_DATA(spi, (uint8_t)(xEnd>>8));
    LCD_WR_DATA(spi, (uint8_t)(0x00FF & xEnd));
    LCD_WR_REG(spi, SSD2119_V_RAM_POS_REG);
    LCD_WR_DATA(spi, (uint8_t)(0xFF & yEnd));
    LCD_WR_DATA(spi, (uint8_t)(0xFF & yStart));
}

//===========================================================================
// Draw a single dot of color c at (x,y)
//===========================================================================
void LCD_DrawPoint(spi_device_handle_t spi, u16 x, u16 y, u16 c)
{
    LCD_WR_REG(spi, SSD2119_X_RAM_ADDR_REG);
    LCD_WR_DATA(spi, (uint8_t)(x>>8));
    LCD_WR_DATA(spi, (uint8_t)(0xFF&x));
    //LCD_WriteData16(spi, x);
    LCD_WR_REG(spi, SSD2119_Y_RAM_ADDR_REG);
    LCD_WR_DATA(spi, (uint8_t)(y>>8));
    LCD_WR_DATA(spi, (uint8_t)(0xFF&y));
    //LCD_WriteData16(spi, y);
    LCD_WR_REG(spi, SSD2119_RAM_DATA_REG);
    LCD_WR_DATA(spi, (uint8_t)(c>>8));
    LCD_WR_DATA(spi, (uint8_t)(0xFF&c));
}

//===========================================================================
// Draw a line of color c from (x1,y1) to (x2,y2).
//===========================================================================
void LCD_DrawLine(spi_device_handle_t spi, u16 x1, u16 y1, u16 x2, u16 y2, u16 c)
{
    u16 t;
    int xerr=0,yerr=0,delta_x,delta_y,distance;
    int incx,incy,uRow,uCol;
    delta_x=x2-x1;
    delta_y=y2-y1;
    uRow=x1;
    uCol=y1;
    if(delta_x>0)incx=1;
    else if(delta_x==0)incx=0;
    else {incx=-1;delta_x=-delta_x;}
    if(delta_y>0)incy=1;
    else if(delta_y==0)incy=0;
    else{incy=-1;delta_y=-delta_y;}
    if( delta_x>delta_y)distance=delta_x;
    else distance=delta_y;
    for(t=0;t<=distance+1;t++ )
    {
        LCD_DrawPoint(spi, uRow,uCol,c);
        xerr+=delta_x ;
        yerr+=delta_y ;
        if(xerr>distance)
        {
            xerr-=distance;
            uRow+=incx;
        }
        if(yerr>distance)
        {
            yerr-=distance;
            uCol+=incy;
        }
    }
}

//===========================================================================
// Draw a rectangle of lines of color c from (x1,y1) to (x2,y2).
//===========================================================================
void LCD_DrawRectangle(spi_device_handle_t spi, u16 x1, u16 y1, u16 x2, u16 y2, u16 c)
{
    LCD_DrawLine(spi, x1,y1,x2,y1,c);
    LCD_DrawLine(spi, x1,y1,x1,y2,c);
    LCD_DrawLine(spi, x1,y2,x2,y2,c);
    LCD_DrawLine(spi, x2,y1,x2,y2,c);
}

//===========================================================================
// Fill a rectangle with color c from (x1,y1) to (x2,y2).
//===========================================================================
void LCD_Fill(spi_device_handle_t spi, u16 sx,u16 sy,u16 ex,u16 ey,u16 color)
{
    u16 i,j;
    u16 width=ex-sx+1;
    u16 height=ey-sy+1;

    LCD_SetWindow(spi, sx,sy,ex,ey);

    for(i=0;i<height;i++)
    {
        for(j=0;j<width;j++)
        LCD_WriteData16(spi, color);
    }

}

//===========================================================================
// Draw a filled rectangle of lines of color c from (x1,y1) to (x2,y2).
//===========================================================================
void LCD_DrawFillRectangle(spi_device_handle_t spi, u16 x1, u16 y1, u16 x2, u16 y2, u16 c)
{
	printf("LCD SSD2119: Drawing Rect.\n");
    LCD_Fill(spi, x1,y1,x2,y2,c);
}

static void _draw_circle_8(spi_device_handle_t spi, int xc, int yc, int x, int y, u16 c)
{
    LCD_DrawPoint(spi, xc + x, yc + y, c);
    LCD_DrawPoint(spi, xc - x, yc + y, c);
    LCD_DrawPoint(spi, xc + x, yc - y, c);
    LCD_DrawPoint(spi, xc - x, yc - y, c);
    LCD_DrawPoint(spi, xc + y, yc + x, c);
    LCD_DrawPoint(spi, xc - y, yc + x, c);
    LCD_DrawPoint(spi, xc + y, yc - x, c);
    LCD_DrawPoint(spi, xc - y, yc - x, c);
}

//===========================================================================
// Draw a circle of color c and radius r at center (xc,yc).
// The fill parameter indicates if it is to be filled.
//===========================================================================
void LCD_Circle(spi_device_handle_t spi, u16 xc, u16 yc, u16 r, u16 fill, u16 c)
{
    int x = 0, y = r, yi, d;
    d = 3 - 2 * r;

    if (fill)
    {
        while (x <= y) {
            for (yi = x; yi <= y; yi++)
                _draw_circle_8(spi, xc, yc, x, yi, c);

            if (d < 0) {
                d = d + 4 * x + 6;
            } else {
                d = d + 4 * (x - y) + 10;
                y--;
            }
            x++;
        }
    } else
    {
        while (x <= y) {
            _draw_circle_8(spi, xc, yc, x, y, c);
            if (d < 0) {
                d = d + 4 * x + 6;
            } else {
                d = d + 4 * (x - y) + 10;
                y--;
            }
            x++;
        }
    }
}

//===========================================================================
// Draw a triangle of lines of color c with vertices at (x0,y0), (x1,y1), (x2,y2).
//===========================================================================
void LCD_DrawTriangle(spi_device_handle_t spi, u16 x0,u16 y0,  u16 x1,u16 y1,  u16 x2,u16 y2, u16 c)
{
    LCD_DrawLine(spi,x0,y0,x1,y1,c);
    LCD_DrawLine(spi,x1,y1,x2,y2,c);
    LCD_DrawLine(spi,x2,y2,x0,y0,c);
}

static void _swap(u16 *a, u16 *b)
{
    u16 tmp;
    tmp = *a;
    *a = *b;
    *b = tmp;
}

//===========================================================================
// Draw a filled triangle of color c with vertices at (x0,y0), (x1,y1), (x2,y2).
//===========================================================================
void LCD_DrawFillTriangle(spi_device_handle_t spi, u16 x0,u16 y0, u16 x1,u16 y1, u16 x2,u16 y2, u16 c)
{
    u16 a, b, y, last;
    int dx01, dy01, dx02, dy02, dx12, dy12;
    long sa = 0;
    long sb = 0;
    if (y0 > y1)
    {
    _swap(&y0,&y1);
        _swap(&x0,&x1);
    }
    if (y1 > y2)
    {
    _swap(&y2,&y1);
        _swap(&x2,&x1);
    }
  if (y0 > y1)
    {
    _swap(&y0,&y1);
        _swap(&x0,&x1);
  }
    if(y0 == y2)
    {
        a = b = x0;
        if(x1 < a)
    {
            a = x1;
    }
    else if(x1 > b)
    {
            b = x1;
    }
    if(x2 < a)
    {
            a = x2;
    }
        else if(x2 > b)
    {
            b = x2;
    }
        LCD_Fill(spi, a,y0,b,y0,c);
    return;
    }
    dx01 = x1 - x0;
    dy01 = y1 - y0;
    dx02 = x2 - x0;
    dy02 = y2 - y0;
    dx12 = x2 - x1;
    dy12 = y2 - y1;

    if(y1 == y2)
    {
        last = y1;
    }
  else
    {
        last = y1-1;
    }
    for(y=y0; y<=last; y++)
    {
        a = x0 + sa / dy01;
        b = x0 + sb / dy02;
        sa += dx01;
    sb += dx02;
    if(a > b)
    {
            _swap(&a,&b);
        }
        LCD_Fill(spi, a,y,b,y,c);
    }
    sa = dx12 * (y - y1);
    sb = dx02 * (y - y0);
    for(; y<=y2; y++)
    {
        a = x1 + sa / dy12;
        b = x0 + sb / dy02;
        sa += dx12;
        sb += dx02;
        if(a > b)
        {
            _swap(&a,&b);
        }
        LCD_Fill(spi, a,y,b,y,c);
    }
}



//===========================================================================
// Display a single character at position x,y on the screen.
// fc,bc are the foreground,background colors
// num is the ASCII character number
// size is the height of the character (either 12 or 16)
// When mode is set, the background will be transparent.
//===========================================================================
void LCD_DrawChar(spi_device_handle_t spi, u16 x, u16 y,u16 fc, u16 bc, u8 num, u8 size, u8 mode)
{
    u8 temp;
    u8 pos,t;
    num=num-' ';
    LCD_SetWindow(spi, x,y,x+size/2-1,y+size-1);
    if (!mode) {
        for(pos=0;pos<size;pos++) {
            if (size == 12)
                temp=asc2_1206[num][pos];
            else
                temp=asc2_1608[num][pos];
            for (t=0;t<size/2;t++) {
                if (temp&0x01)
                	LCD_DrawPoint(spi, x+t, y+pos, fc);
                else
                	LCD_DrawPoint(spi, x+t, y+pos, bc);
                temp>>=1;

            }
        }
    } else {
        for(pos=0;pos<size;pos++)
        {
            if (size==12)
                temp=asc2_1206[num][pos];
            else
                temp=asc2_1608[num][pos];
            for (t=0;t<size/2;t++)
            {
                if(temp&0x01)
                    LCD_DrawPoint(spi, x+t, y+pos, fc);
                temp>>=1;
            }
        }
    }
}

//===========================================================================
// Display a string of characters starting at location x,y.
// fc,bc are the foreground,background colors.
// p is the pointer to the string.
// size is the height of the character (either 12 or 16)
// When mode is set, the background will be transparent.
//===========================================================================
void LCD_DrawString(spi_device_handle_t spi, u16 x,u16 y, u16 fc, u16 bg, const char *p, u8 size, u8 mode)
{
    while((*p<='~')&&(*p>=' '))
    {
        if(x>(lcddev.width-1)||y>(lcddev.height-1))
        	return;
        LCD_DrawChar(spi, x,y,fc,bg,*p,size,mode);
        x+=size/2;
        p++;
    }
}

//===========================================================================
// Draw a picture with upper left corner at (x0,y0).
//===========================================================================

void Main_menu()
{

    const Picture *pic = (const Picture *)&image;
    // No error handling.  Just loop forever if out-of-bounds.
    spi_device_handle_t spi = spi_bus_caller.spi_bus_call;
    lcd_cmd(spi, SSD2119_V_RAM_POS_REG);
    LCD_WR_DATA(spi, 0xEF);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_H_RAM_START_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_H_RAM_END_REG);
    LCD_WR_DATA(spi, 0x01);
    LCD_WR_DATA(spi, (0x3F));

    lcd_cmd(spi, SSD2119_X_RAM_ADDR_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_Y_RAM_ADDR_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_RAM_DATA_REG);
    u8 *data = (u8 *)pic->pixel_data;
    for(int y=0; y<(320*240*2); y++) {
        LCD_WR_DATA(spi, data[y]);
    }

}

//Initialize the display
void lcd_init(spi_device_handle_t spi)
{
    lcddev.setxcmd = SSD2119_X_RAM_ADDR_REG;
    lcddev.setycmd = SSD2119_Y_RAM_ADDR_REG;
    lcddev.wramcmd = SSD2119_RAM_DATA_REG;
    lcddev.height = LCD_H;
    lcddev.width = LCD_W;

    //Initialize non-SPI GPIOs
    gpio_set_direction(PIN_NUM_SDC, GPIO_MODE_OUTPUT);
    gpio_set_direction(PIN_NUM_RST, GPIO_MODE_OUTPUT);
    gpio_set_direction(PIN_NUM_BCKL, GPIO_MODE_OUTPUT);

    //Reset the display
    gpio_set_level(PIN_NUM_RST, 0);
    vTaskDelay(100 / portTICK_RATE_MS);
    gpio_set_level(PIN_NUM_RST, 1);
    vTaskDelay(100 / portTICK_RATE_MS);

    printf("LCD SSD2119 initialization.\n");

    gpio_set_level(PIN_NUM_BCKL, 1);
    lcd_cmd(spi, SSD2119_SLEEP_MODE_1_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x01);

    lcd_cmd(spi, SSD2119_PWR_CTRL_5_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0xB2);

    lcd_cmd(spi, SSD2119_VCOM_OTP_1_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x06);

    lcd_cmd(spi, SSD2119_OSC_START_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x01);

    lcd_cmd(spi, SSD2119_OUTPUT_CTRL_REG);
    LCD_WR_DATA(spi, 0x30);
    LCD_WR_DATA(spi, 0xEF);

    lcd_cmd(spi, SSD2119_LCD_DRIVE_AC_CTRL_REG);
    LCD_WR_DATA(spi, 0x06);
    LCD_WR_DATA(spi, 0x00);

    lcd_cmd(spi, SSD2119_SLEEP_MODE_1_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x00);
	vTaskDelay(300 / portTICK_RATE_MS);

    lcd_cmd(spi, SSD2119_ENTRY_MODE_REG);
    LCD_WR_DATA(spi, 0x62);
    LCD_WR_DATA(spi, 0x30);

    lcd_cmd(spi, SSD2119_SLEEP_MODE_2_REG);
    LCD_WR_DATA(spi, 0x09);
    LCD_WR_DATA(spi, 0x99);

    lcd_cmd(spi, SSD2119_DISPLAY_CTRL_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x33);

    lcd_cmd(spi, SSD2119_PWR_CTRL_2_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, 0x05);

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_1_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_2_REG);
    LCD_WR_DATA(spi, 0x03);
    LCD_WR_DATA(spi, (0x03));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_3_REG);
    LCD_WR_DATA(spi, 0x04);
    LCD_WR_DATA(spi, (0x07));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_4_REG);
    LCD_WR_DATA(spi, 0x03);
    LCD_WR_DATA(spi, (0x01));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_5_REG);
    LCD_WR_DATA(spi, 0x03);
    LCD_WR_DATA(spi, (0x01));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_6_REG);
    LCD_WR_DATA(spi, 0x04);
    LCD_WR_DATA(spi, (0x03));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_7_REG);
    LCD_WR_DATA(spi, 0x07);
    LCD_WR_DATA(spi, (0x07));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_8_REG);
    LCD_WR_DATA(spi, 0x04);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_9_REG);
    LCD_WR_DATA(spi, 0x0A);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_GAMMA_CTRL_10_REG);
    LCD_WR_DATA(spi, 0x10);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_PWR_CTRL_3_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x0A));

    lcd_cmd(spi, SSD2119_PWR_CTRL_4_REG);
    LCD_WR_DATA(spi, 0x2E);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_V_RAM_POS_REG);
    LCD_WR_DATA(spi, 0xEF);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_H_RAM_START_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_H_RAM_END_REG);
    LCD_WR_DATA(spi, 0x01);
    LCD_WR_DATA(spi, (0x3F));

    lcd_cmd(spi, SSD2119_X_RAM_ADDR_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_Y_RAM_ADDR_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));

    lcd_cmd(spi, SSD2119_RAM_DATA_REG);
    LCD_WR_DATA(spi, 0x00);
    LCD_WR_DATA(spi, (0x00));
/*
    uint32_t ulCount;
    volatile uint32_t i;
    lcd_cmd(spi, SSD2119_RAM_DATA_REG);
    for(ulCount = 0; ulCount < 76800; ulCount++)
    {
        LCD_WR_DATA(spi, 0xF6);
        LCD_WR_DATA(spi, (0x47));    // Black
        //HAL_LCD_writeData(0xF800);    // Red
        //HAL_LCD_writeData(0x07E0);    // Green
        //HAL_LCD_writeData(0x001F);    // Blue
    }
    */
    printf("LCD SSD2119 initialization Complete.\n");
/*
 *
    //Send all the commands
    while (lcd_init_cmds[cmd].databytes!=0xff) {
        lcd_cmd(spi, lcd_init_cmds[cmd].cmd);
        lcd_data(spi, lcd_init_cmds[cmd].data, lcd_init_cmds[cmd].databytes&0x1F);
        if (lcd_init_cmds[cmd].databytes&0x80) {
            vTaskDelay(100 / portTICK_RATE_MS);
        }
        cmd++;
    }
    vTaskDelay(30 / portTICK_RATE_MS);
    lcd_init_cmds = ssd_init2_cmds;

    //Send all the commands
    while (lcd_init_cmds[cmd].databytes!=0xff) {
        lcd_cmd(spi, lcd_init_cmds[cmd].cmd);
        lcd_data(spi, lcd_init_cmds[cmd].data, lcd_init_cmds[cmd].databytes&0x1F);
        if (lcd_init_cmds[cmd].databytes&0x80) {
            vTaskDelay(100 / portTICK_RATE_MS);
        }
        cmd++;
    }

    ///Enable backlight
    gpio_set_level(PIN_NUM_BCKL, 1);
    printf("LCD SSD2119 initialization Complete.\n");
*/
}
void begin_displaying()
{
    esp_err_t ret;
    spi_device_handle_t spi;
    spi_bus_config_t buscfg={
        .miso_io_num=PIN_NUM_MISO,
        .mosi_io_num=PIN_NUM_SDI,
        .sclk_io_num=PIN_NUM_SCL,
        .quadwp_io_num=-1,
        .quadhd_io_num=-1,
        .max_transfer_sz=320*2+8
    };
    spi_device_interface_config_t devcfg={
#ifdef CONFIG_LCD_OVERCLOCK
        .clock_speed_hz=26*1000*1000,           //Clock out at 26 MHz
#else
        .clock_speed_hz=26*1000*1000,           //Clock out at 10 MHz
#endif
        .mode=0,                                //SPI mode 0
        .spics_io_num=PIN_NUM_SCS,               //CS pin
        .queue_size=9,                          //We want to be able to queue 7 transactions at a time
        .pre_cb=lcd_spi_pre_transfer_callback,  //Specify pre-transfer callback to handle D/C line
    };
    //Initialize the SPI bus
    ret=spi_bus_initialize(HSPI_HOST, &buscfg, 1);
    ESP_ERROR_CHECK(ret);
    //Attach the LCD to the SPI bus
    ret=spi_bus_add_device(HSPI_HOST, &devcfg, &spi);
    ESP_ERROR_CHECK(ret);
    //Initialize the LCD
    lcd_init(spi);
    //LCD_DrawChar(spi, 50, 50, BLUE, RED, 'A', 16, 1);
    spi_bus_caller.spi_bus_call = spi;
    Main_menu();
    LCD_DrawString(spi, 50,112, BLACK, GREEN, "Adam", 12, 1);
}


